<div class="app-container">
  <app-header
    [title]="title"
    [selectedYear]="selectedYear"
    [currentYear]="currentYear"
    [availableYears]="availableYears"
    (loadFakeData)="loadFakeData()"
    (clearAllData)="clearAllData()"
    (toggleSidebar)="toggleSidebar()"
    (printAssessment)="printAssessment()"
    (yearChange)="onYearChange($event)"
  ></app-header>

  @if (assessmentData) {
  <!-- Sidebar Tab/Handle - positioned outside sidenav container -->
  <div
    class="sidebar-tab"
    [class.sidebar-open]="sidebarOpen"
    (click)="toggleSidebar()"
    matTooltip="Toggle Scoring Overview"
    matTooltipPosition="left"
  >
    <mat-icon>assessment</mat-icon>
  </div>

  <mat-sidenav-container class="main-container">
    <!-- Scoring Sidebar -->
    <mat-sidenav
      mode="side"
      [opened]="sidebarOpen"
      position="end"
      class="scoring-sidebar"
    >
      <app-scoring-sidebar
        [selectedYear]="selectedYear"
        [currentYear]="currentYear"
        [assessmentData]="assessmentData"
        [selectedTabIndex]="selectedTabIndex"
        [scoreValues]="getScoreValues()"
        [selectedScores]="selectedScores"
        [sectionColors]="sectionColors"
        (toggleSidebar)="toggleSidebar()"
      ></app-scoring-sidebar>
    </mat-sidenav>

    <!-- Main Content -->
    <mat-sidenav-content class="main-content">
      <div class="tabs-container">
        <mat-tab-group
          mat-align-tabs="center"
          class="assessment-tabs"
          [(selectedIndex)]="selectedTabIndex"
          [style.--current-tab-color]="getCurrentTabColor()"
        >
          <!-- Home Tab -->
          <mat-tab label="Home">
            <div class="tab-content">
              <mat-card class="welcome-card">
                <mat-card-header>
                  <mat-card-title>Welcome to the Assessment</mat-card-title>
                </mat-card-header>
                <mat-card-content>
                  <p>
                    This assessment framework is designed to evaluate early
                    years development across four key areas:
                  </p>
                  <div class="overview-grid">
                    @for (section of
                    assessmentData.assessment_framework.sections; track
                    section.title; let i = $index) {
                    <mat-card
                      class="overview-card clickable-card"
                      (click)="navigateToSection(i)"
                      [style.--section-primary]="
                        getSectionColor(section.title, 'primary')
                      "
                      [style.--section-light]="
                        getSectionColor(section.title, 'light')
                      "
                      [style.--section-hover]="
                        getSectionColor(section.title, 'hover')
                      "
                    >
                      <mat-card-header>
                        <mat-card-title>{{ section.title }}</mat-card-title>
                      </mat-card-header>
                      <mat-card-content>
                        <p>
                          {{ section.subsections.length }} subsections with
                          {{ getTotalQuestions(section) }} questions
                        </p>
                      </mat-card-content>
                    </mat-card>
                    }
                  </div>
                  <div class="scoring-info">
                    <h3>Scoring System</h3>
                    <div class="scoring-grid">
                      @for (score of getScoreValues(); track score.value) {
                      <div class="scoring-item">
                        <strong>{{ score.label }}</strong> ({{
                          score.value
                        }}
                        mark{{ score.value > 1 ? "s" : "" }})
                        <br />
                        <small>{{ score.description }}</small>
                      </div>
                      }
                    </div>
                  </div>

                  <!-- Assessment Progress Overview -->
                  @if (hasAnyScores()) {
                  <app-assessment-progress
                    [assessmentData]="assessmentData"
                    [availableYears]="availableYears"
                    [currentYear]="currentYear"
                    [yearlyScores]="yearlyScores"
                    [expandedYears]="expandedYears"
                    [sectionColors]="sectionColors"
                    (yearDetailsToggled)="onYearDetailsToggled($event)"
                  ></app-assessment-progress>
                  }
                </mat-card-content>
              </mat-card>
            </div>
          </mat-tab>

          <!-- Assessment Section Tabs -->
          @for (section of assessmentData.assessment_framework.sections; track
          section.title) {
          <mat-tab [label]="section.title">
            <app-assessment-section
              [section]="section"
              [scoreValues]="getScoreValues()"
              [selectedScores]="selectedScores"
              [sectionColors]="sectionColors"
              (scoreSelected)="onScoreSelected($event)"
            >
            </app-assessment-section>
          </mat-tab>
          }
        </mat-tab-group>
      </div>
    </mat-sidenav-content>
  </mat-sidenav-container>
  } @if (!assessmentData) {
  <div class="loading">
    <p>Loading assessment data...</p>
  </div>
  }
</div>
